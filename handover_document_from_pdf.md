# TXN 專案無痛交接文件

## 1. 專案概況與目標

TXN 是一個旨在打造市場上最優雅、最高效的線上交易日誌的專案。其核心願景是透過直覺的數據視覺化和深度分析，賦能每一位交易者，幫助他們洞察自我、優化策略，並在充滿挑戰的市場中自信地成長。專案的核心理念是「數據的優雅 (Data-Driven Elegance)」，強調以最清晰、最富有洞察力且最美觀的方式呈現數據，以創造使用者「掌控全局」的專業感與愉悅感。

### 1.1 產品名稱

TXN

### 1.2 產品願景

TXN 不僅僅是一個記錄工具，它更是一位智慧的交易夥伴，透過直覺的數據視覺化和深度分析，賦能每一位交易者，幫助他們洞察自我、優化策略，在充滿挑戰的市場中自信地成長。

### 1.3 核心理念

**數據的優雅 (Data-Driven Elegance)**。每一個設計決策、每一次互動體驗，都旨在讓數據以最清晰、最富有洞察力且最美觀的方式呈現，創造「掌控全局」的專業感與愉悅感。

### 1.4 品牌識別與設計語言

*   **Logo 概念:** 一個簡潔、抽象的標誌，融合「上升曲線」與「翻開的日誌」意象，直觀傳達數據分析與交易記錄的核心價值。

*   **色彩計畫:**

| 類別 | 顏色名稱 | HEX (參考) | 用途 |
| :--- | :--- | :--- | :--- |
| **主色調** | 深邃科技藍 | `#1A202C` | 背景、導航列、卡片，營造沉穩專業氛圍。 |
| **強調色** | 活力金 | `#FBBF24` | 主要按鈕 (CTA)、關鍵指標、視覺焦點。 |
| **語意色 (獲利)** | 沉穩森林綠 | `#228B22` | 獲利數字、正面指標、成功提示。 |
| **語意色 (虧損)** | 冷靜緋紅 | `#DC143C` | 虧損數字、負面指標、警示提示。 |

*   **字體選擇:**
    *   **介面文字:** Inter 或 Nunito Sans。確保在所有尺寸下的極致可讀性。
    *   **數字顯示:** Roboto Mono 或 Fira Code。在儀表板和表格的關鍵數據上使用等寬字體，確保數字垂直對齊，彰顯金融數據的專業性。

### 1.5 核心功能概述

TXN 的核心功能包括：

*   **新增/編輯交易:** 透過彈出式模態視窗，支援雙欄佈局，可選擇交易方向（獲利綠/虧損紅的 Toggle Button），自動計算並顯示「風險回報比 R/R Ratio」，支援策略標籤，並可拖放上傳交易截圖。
*   **交易歷史:** 提供多功能篩選器欄，支援按日期、商品、策略進行篩選與排序，「損益」欄位根據正負值進行顏色標記，並提供清晰的「編輯」與「刪除」操作入口。
*   **儀表板:** 採用響應式卡片式佈局，包含 KPI 卡片（顯示總損益、勝率、賺賠比等核心指標，數字採用等寬字體並具備趨勢箭頭）、權益曲線圖（佔據視覺核心，使用科技青漸層填充，提供互動式提示框），以及近期交易列表。

### 1.6 Post-MVP 規劃 (V1.1 預覽)

*   **進階分析頁面:** 包含「依策略分析」（條形圖）和「依商品分析」（氣泡圖）的專屬頁面。
*   **CSV 匯入功能:** 提供引導式介面，支援使用者從券商匯入歷史數據。

## 2. 技術棧與環境設定

TXN 專案採用現代化的技術棧，旨在提供高效、可擴展且易於維護的開發環境。以下是專案的主要技術組成部分及其相關設定。

### 2.1 主要技術棧

| 類別 | 技術 | 說明 |
| :--- | :--- | :--- |
| **前端框架** | Next.js 15 with TypeScript | 用於構建使用者介面，提供伺服器端渲染 (SSR) 和靜態網站生成 (SSG) 能力。 |
| **樣式** | Tailwind CSS | 一個實用優先的 CSS 框架，用於快速構建響應式設計。 |
| **後端即服務 (BaaS)** | Supabase | 提供 PostgreSQL 資料庫、使用者認證、API 和儲存功能，簡化後端開發。 |
| **部署** | Netlify | 用於自動化部署前端應用，支援持續整合與部署 (CI/CD)。 |
| **版本控制** | GitHub | 用於程式碼託管、版本管理和團隊協作。 |

### 2.2 開發環境設定

為了順利啟動 TXN 專案的開發環境，請遵循以下步驟：

1.  **複製環境變數檔案:**
    在專案根目錄下，複製 `.env.example` 檔案並重新命名為 `.env.local`。此檔案將用於儲存敏感的環境變數，例如 Supabase 憑證。
    ```bash
    cp .env.example .env.local
    ```

2.  **配置 Supabase 憑證:**
    打開新建立的 `.env.local` 檔案，並填入您的 Supabase 專案 URL 和匿名金鑰。這些憑證可以在您的 Supabase 專案設定中找到。
    ```
    NEXT_PUBLIC_SUPABASE_URL=your_supabase_project_url
    NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
    ```

3.  **安裝依賴並啟動開發伺服器:**
    在專案根目錄下，執行以下命令來安裝所有必要的 Node.js 依賴，並啟動本地開發伺服器。這將允許您在瀏覽器中預覽應用程式。
    ```bash
    npm install
    npm run dev
    ```

### 2.3 部署設定 (Netlify 自動部署)

TXN 專案配置了 Netlify 自動部署，以實現高效的持續整合與部署流程。以下是部署的關鍵設定：

1.  **GitHub Repository 設定:**
    確保專案程式碼已推送到 GitHub 倉庫。建議倉庫名稱為 `txn-website`。

2.  **Netlify 控制台設定:**
    *   登入您的 Netlify 控制台。
    *   點擊 "New site from Git"。
    *   選擇 GitHub 並授權 Netlify 訪問您的倉庫。
    *   選擇 `txn-website` 倉庫。
    *   **建置命令 (Build command):** `npm run build`。此命令將用於在 Netlify 上建置 Next.js 應用程式。
    *   **發佈目錄 (Publish directory):** `.next`。這是 Next.js 建置後生成靜態檔案的目錄。
    *   在 Netlify 環境變數中，加入與 `.env.local` 中相同的 Supabase 憑證 (`NEXT_PUBLIC_SUPABASE_URL` 和 `NEXT_PUBLIC_SUPABASE_ANON_KEY`)，以確保部署的應用程式能夠正確連接到 Supabase 後端。

### 2.4 Supabase 相關資訊

專案的後端主要依賴於 Supabase。以下是一些重要的 Supabase 相關文件和腳本：

*   `SUPABASE_QUICKSTART.md`：提供 Supabase 快速入門指南。
*   `SUPABASE_SETUP.md`：詳細說明 Supabase 的設定步驟。
*   `sql-scripts/`：包含資料庫遷移腳本和快速設定管理員帳戶的 SQL 腳本。
    *   `20250825_180000_create_test_admin_fixed.sql`：創建測試管理員帳戶的腳本。
    *   `20250825_185000_add_email_unique_constraint.sql`：添加電子郵件唯一約束的遷移腳本。
    *   `quick_admin_setup.sql`：快速管理員設定腳本。
    *   `reset_admin_password.sql`：重置管理員密碼的腳本。
    *   `reset_existing_admin_simple.sql`：重置現有管理員的簡單腳本。
    *   `setup_admin_test.sql`：設定測試管理員的腳本。
    *   `TXN 資料庫遷移腳本.md`：關於 TXN 資料庫遷移的說明文件。

請務必仔細閱讀這些文件和腳本，以了解 Supabase 資料庫結構和管理相關操作。

## 3. 開發流程與規範

TXN 專案的開發流程遵循敏捷開發原則，並結合了特定的規範以確保程式碼品質和團隊協作效率。本節將詳細說明開發流程、程式碼規範、測試策略以及版本控制的最佳實踐。

### 3.1 開發流程

專案採用迭代開發模式，每個迭代週期（Sprint）通常為 1-2 週。主要流程如下：

1.  **需求分析與規劃 (Requirement Analysis & Planning):**
    *   產品經理與設計師定義使用者故事 (User Stories) 和功能需求。
    *   開發團隊參與需求評審，評估技術可行性和工作量。
    *   將使用者故事拆分為可執行的任務 (Tasks)，並分配給團隊成員。

2.  **開發與實作 (Development & Implementation):**
    *   開發人員根據分配的任務進行程式碼編寫。
    *   鼓勵頻繁地提交程式碼到各自的功能分支 (Feature Branches)。
    *   進行單元測試 (Unit Tests) 和整合測試 (Integration Tests) 以確保程式碼品質。

3.  **程式碼審查 (Code Review):**
    *   功能開發完成後，提交 Pull Request (PR) 到 `main` 分支。
    *   至少一位團隊成員對 PR 進行程式碼審查，確保程式碼符合規範、邏輯正確且沒有潛在問題。
    *   審查通過後，合併程式碼到 `main` 分支。

4.  **測試與驗證 (Testing & Validation):**
    *   測試人員或開發人員在測試環境中進行功能測試 (Functional Tests) 和使用者驗收測試 (UAT)。
    *   發現 Bug 時，及時記錄並分配給相關開發人員修復。

5.  **部署與發布 (Deployment & Release):**
    *   當 `main` 分支的程式碼達到可發布狀態時，透過 Netlify 自動部署到生產環境。
    *   發布後持續監控系統運行狀況。

### 3.2 程式碼規範

為了保持程式碼的一致性和可讀性，請遵循以下規範：

*   **命名約定:**
    *   變數、函數使用 `camelCase` (例如：`userName`, `getUserData`)。
    *   組件、類別使用 `PascalCase` (例如：`LoginForm`, `AuthContext`)。
    *   常數使用 `SCREAMING_SNAKE_CASE` (例如：`API_BASE_URL`)。
*   **格式化:**
    *   使用 Prettier 進行程式碼自動格式化，確保所有程式碼風格一致。
    *   建議在開發環境中配置 Prettier 插件，以便在保存時自動格式化。
*   **ESLint:**
    *   專案配置了 ESLint，用於靜態程式碼分析，檢測潛在的錯誤和風格問題。
    *   請確保在提交程式碼前解決所有 ESLint 警告和錯誤。
*   **註釋:**
    *   為複雜的邏輯、非直觀的程式碼或未來可能需要修改的部分添加清晰的註釋。
    *   對於公共函數或組件，使用 JSDoc 格式添加函數說明、參數和返回值說明。

### 3.3 測試策略

專案採用多層次的測試策略，以確保軟體品質：

*   **單元測試 (Unit Testing):**
    *   針對獨立的函數、組件或模組進行測試，確保其行為符合預期。
    *   建議使用 Jest 和 React Testing Library 進行前端單元測試。
*   **整合測試 (Integration Testing):**
    *   測試不同模組或服務之間的互動，確保它們能正確協同工作。
    *   例如，測試前端與 Supabase API 的互動。
*   **端對端測試 (End-to-End Testing - E2E):**
    *   模擬真實使用者場景，從頭到尾測試整個應用程式流程。
    *   建議使用 Cypress 或 Playwright 進行 E2E 測試。

### 3.4 版本控制 (Git) 最佳實踐

專案使用 Git 進行版本控制，並遵循以下最佳實踐：

*   **分支策略:**
    *   `main` 分支：用於生產環境的穩定程式碼，只接受來自功能分支的合併請求。
    *   `develop` 分支：用於整合所有已完成的功能，作為下一個發布版本的基礎。
    *   功能分支 (Feature Branches)：從 `develop` 分支切出，用於開發單一功能或修復 Bug。命名規範為 `feature/your-feature-name` 或 `bugfix/your-bug-name`。
*   **提交訊息 (Commit Messages):**
    *   使用清晰、簡潔且有意義的提交訊息。
    *   建議遵循 Conventional Commits 規範，例如：`feat: add new user registration form` 或 `fix: correct login redirection bug`。
*   **Pull Request (PR):**
    *   在提交 PR 時，提供詳細的描述，包括本次 PR 的目的、解決的問題、相關的任務 ID (如果有的話) 以及任何需要審查者注意的點。
    *   確保 PR 通過所有自動化測試和程式碼審查後再合併。

透過遵循這些開發流程與規範，我們可以確保 TXN 專案的開發效率、程式碼品質和團隊協作的順暢性。

## 4. 後續工作與注意事項

本節將列出 TXN 專案在 MVP (Minimum Viable Product) 上線後，未來需要進行的後續工作，以及在維護和開發過程中需要特別注意的事項。

### 4.1 開發里程碑回顧與後續規劃

專案的開發里程碑分為四個階段，目前已完成 MVP 的開發與上線。以下是各階段的目標與關鍵里程碑，以及後續工作的銜接點：

#### 第一階段：基礎設施與環境建置
*   **目標：** 建立穩定、自動化的專案基礎設施。
*   **關鍵里程碑：** `Supabase` 專案建立、`trades` 資料表定義、`GitHub` 倉庫初始化、`Netlify` 自動化部署通路建立。
*   **後續銜接：** 此階段已完成，確保開發環境和部署流程的穩定性是後續所有開發的基礎。

#### 第二階段：核心功能閉環開發
*   **目標：** 實現使用者從登入到完成一筆完整交易記錄的核心功能。
*   **關鍵里程碑：** 使用者認證系統完成、「新增/編輯交易」功能完成、「交易歷史」頁面 CRUD 功能完成。
*   **後續銜接：** 核心交易記錄功能已可運作，後續需持續優化使用者體驗，並根據使用者回饋進行功能迭代。

#### 第三階段：數據視覺化與儀表板整合
*   **目標：** 將原始數據轉化為富有洞察力的視覺化圖表。
*   **關鍵里程碑：** 儀表板靜態 UI 完成、核心 KPI 計算邏輯實現、儀表板數據動態化完成。
*   **後續銜接：** 儀表板已初步整合，未來需進一步豐富圖表類型、提升數據分析深度，並考慮加入更多自定義選項。

#### 第四階段：品質保證與 MVP 上線
*   **目標：** 確保產品穩定性與使用者體驗，準備正式上線。
*   **關鍵里程碑：** 端對端測試通過、響應式設計優化完成、高優先級 Bug 修復、**MVP 開發完成**。
*   **後續銜接：** MVP 已上線，接下來的工作重點將轉向使用者回饋收集、功能優化、新功能開發以及持續的系統維護。

### 4.2 未來功能開發方向 (Post-MVP)

根據產品開發總計畫書，以下是未來版本 (V1.1 預覽) 的主要功能開發方向：

*   **進階分析頁面：**
    *   **依策略分析：** 開發專屬頁面，透過條形圖等形式，深入分析不同交易策略的表現，幫助使用者評估策略有效性。
    *   **依商品分析：** 開發專屬頁面，透過氣泡圖等形式，分析不同交易商品的表現，幫助使用者了解各商品的風險與收益。
*   **CSV 匯入功能：**
    *   提供引導式介面，支援使用者從券商匯入歷史交易數據。這將大大降低使用者遷移成本，提升產品吸引力。
    *   需要考慮不同券商的 CSV 格式差異，並設計靈活的解析器。

### 4.3 維護與監控

*   **系統監控：** 持續監控應用程式的運行狀況，包括伺服器負載、資料庫性能、錯誤日誌等。可以使用 Netlify 和 Supabase 提供的監控工具，或整合第三方監控服務。
*   **錯誤處理：** 建立完善的錯誤日誌系統，並定期審查錯誤日誌，及時發現並修復問題。
*   **安全性更新：** 定期檢查所有依賴庫和框架的安全漏洞，並及時進行更新。特別是 Supabase 和 Next.js 的安全公告。
*   **資料庫備份：** 確保 Supabase 資料庫有定期備份機制，以防資料丟失。

### 4.4 溝通與協作

*   **團隊溝通：** 保持與產品經理、設計師和其他開發人員的密切溝通，確保對產品需求和開發進度有共同的理解。
*   **文件更新：** 隨著專案的發展，及時更新相關文件，包括本交接文件、README、API 文件等，確保資訊的時效性和準確性。
*   **使用者回饋：** 積極收集使用者回饋，並將其納入產品優化和新功能開發的考量。

### 4.5 注意事項

*   **環境變數管理：** 敏感資訊（如 API 金鑰）應儲存在環境變數中，切勿直接寫入程式碼並提交到版本控制系統。
*   **性能優化：** 隨著使用者量的增長和功能複雜度的提升，需持續關注應用程式的性能，進行必要的優化，例如程式碼分割、圖片優化、資料庫查詢優化等。
*   **響應式設計：** 確保所有新開發的功能都具備良好的響應式設計，以適應不同設備的螢幕尺寸。
*   **測試覆蓋率：** 盡可能提高單元測試和整合測試的覆蓋率，以減少 Bug 的產生並提高開發效率。

遵循這些後續工作和注意事項，將有助於 TXN 專案的持續發展和穩定運行。

## 5. 常見問題與解決方案

本節將列出在 TXN 專案開發、部署和維護過程中可能遇到的一些常見問題，並提供相應的解決方案，以幫助新接手的開發人員快速排查和解決問題。

### 5.1 開發環境問題

**問題 1: `npm install` 失敗或依賴安裝錯誤。**
*   **可能原因:** Node.js 版本不相容、網路問題、npm 快取損壞。
*   **解決方案:**
    1.  **檢查 Node.js 版本:** 確保您的 Node.js 版本符合專案要求 (通常在 `package.json` 中有指定)。建議使用 `nvm` (Node Version Manager) 來管理 Node.js 版本。
    2.  **清除 npm 快取:** 執行 `npm cache clean --force`，然後重新執行 `npm install`。
    3.  **檢查網路連接:** 確保網路連接穩定，沒有防火牆或代理問題。
    4.  **刪除 `node_modules` 和 `package-lock.json`:** 執行 `rm -rf node_modules && rm package-lock.json`，然後重新執行 `npm install`。

**問題 2: `npm run dev` 啟動失敗或頁面無法載入。**
*   **可能原因:** 環境變數配置錯誤、端口被佔用、程式碼語法錯誤。
*   **解決方案:**
    1.  **檢查 `.env.local`:** 確保 `NEXT_PUBLIC_SUPABASE_URL` 和 `NEXT_PUBLIC_SUPABASE_ANON_KEY` 配置正確，且沒有多餘的空格或錯誤的字元。
    2.  **檢查端口佔用:** 如果提示端口被佔用，可以嘗試更改 Next.js 的預設端口 (通常是 3000)。或者找到佔用端口的程序並終止它。
    3.  **檢查終端機輸出:** 仔細閱讀 `npm run dev` 的終端機輸出，通常會有詳細的錯誤訊息指出問題所在。
    4.  **檢查最近的程式碼更改:** 如果是最近的更改導致的問題，嘗試回溯到上一個正常工作的版本。

### 5.2 Supabase 相關問題

**問題 1: 無法連接到 Supabase 資料庫。**
*   **可能原因:** Supabase 憑證錯誤、網路防火牆限制、Supabase 專案狀態異常。
*   **解決方案:**
    1.  **驗證憑證:** 再次確認 `.env.local` 中的 `NEXT_PUBLIC_SUPABASE_URL` 和 `NEXT_PUBLIC_SUPABASE_ANON_KEY` 是否與 Supabase 控制台中的憑證完全一致。
    2.  **檢查網路連接:** 確保您的開發環境可以訪問 Supabase 的伺服器。
    3.  **檢查 Supabase 專案狀態:** 登入 Supabase 控制台，檢查您的專案是否正常運行，沒有任何服務中斷。
    4.  **檢查資料庫規則 (Row Level Security):** 確保您的資料庫表已正確配置 RLS 策略，允許應用程式進行讀寫操作。

**問題 2: Supabase 認證功能異常 (例如：註冊或登入失敗)。**
*   **可能原因:** Supabase 認證設定錯誤、電子郵件服務配置問題、資料庫中的使用者資料問題。
*   **解決方案:**
    1.  **檢查 Supabase 認證設定:** 在 Supabase 控制台的「Authentication」部分，檢查相關設定，例如是否啟用了電子郵件驗證、是否配置了正確的 SMTP 服務 (如果需要發送驗證郵件)。
    2.  **檢查資料庫 `auth.users` 表:** 檢查 `auth.users` 表中是否有重複的電子郵件或不正確的使用者狀態。
    3.  **查看 Supabase 認證日誌:** 在 Supabase 控制台中查看認證服務的日誌，可以幫助定位問題。

### 5.3 部署相關問題 (Netlify)

**問題 1: Netlify 部署失敗。**
*   **可能原因:** 建置命令錯誤、發佈目錄錯誤、環境變數缺失、程式碼中存在建置錯誤。
*   **解決方案:**
    1.  **檢查 Netlify 建置日誌:** 這是排查部署問題最重要的地方。Netlify 會提供詳細的建置日誌，指出在哪個步驟失敗以及具體的錯誤訊息。
    2.  **確認建置命令和發佈目錄:** 確保 Netlify 的建置命令 (`npm run build`) 和發佈目錄 (`.next`) 配置正確。
    3.  **檢查 Netlify 環境變數:** 確保在 Netlify 上配置了所有必要的環境變數，特別是 Supabase 憑證。
    4.  **本地建置測試:** 在本地環境執行 `npm run build`，確保專案可以成功建置，沒有任何編譯錯誤。

**問題 2: 部署成功但網站功能異常。**
*   **可能原因:** 環境變數在部署環境中未正確載入、API 請求被 CORS 策略阻擋、後端服務未正常運行。
*   **解決方案:**
    1.  **檢查瀏覽器控制台:** 打開部署後網站的瀏覽器控制台，查看是否有 JavaScript 錯誤或網路請求錯誤 (例如 4xx 或 5xx 錯誤)。
    2.  **確認環境變數:** 確保部署環境中的環境變數與開發環境一致，特別是那些影響 API 請求的變數。
    3.  **檢查 CORS 設定:** 如果有跨域請求問題，請檢查 Supabase 或其他後端服務的 CORS (Cross-Origin Resource Sharing) 設定，確保允許來自您網站域名的請求。
    4.  **查看後端服務日誌:** 如果後端服務是獨立部署的，檢查其日誌以確認是否有錯誤發生。

### 5.4 其他常見問題

**問題 1: 頁面樣式錯亂或未載入。**
*   **可能原因:** Tailwind CSS 配置問題、CSS 檔案未正確引入、快取問題。
*   **解決方案:**
    1.  **清除瀏覽器快取:** 硬性重新載入頁面 (Ctrl+Shift+R 或 Cmd+Shift+R)。
    2.  **檢查 Tailwind CSS 配置:** 確保 `tailwind.config.js` 配置正確，並且所有需要掃描的檔案路徑都已包含在 `content` 陣列中。
    3.  **檢查 CSS 引入:** 確保 `globals.css` 或其他 CSS 檔案在 `layout.tsx` 中正確引入。

**問題 2: 數據顯示不正確或未更新。**
*   **可能原因:** 資料庫查詢錯誤、快取問題、前端數據狀態管理問題。
*   **解決方案:**
    1.  **檢查資料庫:** 直接登入 Supabase 控制台，檢查相關資料表中的數據是否正確。
    2.  **檢查 API 請求:** 使用瀏覽器開發者工具檢查前端發送的 API 請求和接收到的響應，確認數據是否正確傳輸。
    3.  **清除前端快取:** 如果應用程式使用了客戶端數據快取，嘗試清除它。
    4.  **檢查狀態管理:** 如果使用了 React Context 或其他狀態管理庫，檢查數據流是否正確。

通過查閱本節，希望能夠幫助您快速定位並解決在 TXN 專案中可能遇到的問題。如果問題依然存在，請詳細記錄錯誤訊息和重現步驟，並尋求團隊協助。


