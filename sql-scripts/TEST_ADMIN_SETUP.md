# TXN æ¸¬è©¦ç®¡ç†å“¡å¸³è™Ÿè¨­ç½®æŒ‡å—

## âš ï¸ é‡è¦æ›´æ–°ï¼šå¤–éµç´„æŸéŒ¯èª¤ä¿®å¾©

å¦‚æœæ‚¨é‡åˆ°ä»¥ä¸‹éŒ¯èª¤ï¼š
```
ERROR: 23503: insert or update on table "user_profiles" violates foreign key constraint "user_profiles_id_fkey"
```

è«‹ä½¿ç”¨ä¿®å¾©ç‰ˆè…³æœ¬ï¼š`20250825_180000_create_test_admin_fixed.sql`

## ğŸ” æ¸¬è©¦ç®¡ç†å“¡å¸³è™Ÿè³‡è¨Š

### å»ºè­°çš„æ¸¬è©¦å¸³è™Ÿ
- **Email**: `admin@txn.test`
- **Password**: `AdminTest123!`
- **è§’è‰²**: ç®¡ç†å“¡ (admin)
- **ç‹€æ…‹**: æ´»èº (active)

## ğŸ“‹ è¨­ç½®æ­¥é©Ÿ (ä¿®å¾©ç‰ˆ)

ä¿®å¾©ç‰ˆè…³æœ¬æä¾›ä¸‰ç¨®æ–¹æ³•ï¼Œè«‹é¸æ“‡æœ€é©åˆæ‚¨æƒ…æ³çš„æ–¹æ³•ï¼š

### ğŸ”§ æ–¹æ³•é¸æ“‡æŒ‡å—

1. **æ–¹æ³•ä¸€ (æ¨è–¦)**: éœ€è¦çœŸæ­£ç™»å…¥æ¸¬è©¦ â†’ æ‰‹å‹•åœ¨ Supabase Auth å‰µå»ºç”¨æˆ¶
2. **æ–¹æ³•äºŒ**: å·²æœ‰èªè­‰ç”¨æˆ¶ â†’ è‡ªå‹•æª¢æ¸¬ä¸¦è¨­ç½®ç‚ºç®¡ç†å“¡
3. **æ–¹æ³•ä¸‰**: åƒ…æ¸¬è©¦é¢æ¿é¡¯ç¤º â†’ ç´”æ•¸æ“šæ¸¬è©¦ï¼Œç„¡æ³•ç™»å…¥

---

### ğŸ“± æ–¹æ³•ä¸€ï¼šæ‰‹å‹•è¨­ç½® (æ¨è–¦)

#### æ­¥é©Ÿ 1: åœ¨ Supabase Auth ä¸­å‰µå»ºç”¨æˆ¶
1. ç™»å…¥ [Supabase Dashboard](https://supabase.com/dashboard)
2. é¸æ“‡æ‚¨çš„ TXN å°ˆæ¡ˆ
3. å‰å¾€ **Authentication** â†’ **Users**
4. é»æ“Š **Add user** æˆ– **Invite**
5. è¼¸å…¥ä»¥ä¸‹è³‡è¨Šï¼š
   - **Email**: `admin@txn.test`
   - **Password**: `AdminTest123!`
   - âœ… å‹¾é¸ **Auto Confirm User** (è‡ªå‹•ç¢ºèªç”¨æˆ¶)
6. é»æ“Š **Send invitation** æˆ– **Create user**
7. **é‡è¦**: è¤‡è£½ç”Ÿæˆçš„ **User ID** (UUIDæ ¼å¼)

#### æ­¥é©Ÿ 2: åŸ·è¡Œä¿®å¾©ç‰ˆ SQL è…³æœ¬
1. åœ¨ **SQL Editor** ä¸­åŸ·è¡Œ `20250825_180000_create_test_admin_fixed.sql`
2. æ‰¾åˆ°ã€Œæ–¹æ³•ä¸€ã€éƒ¨åˆ†ï¼Œå–æ¶ˆè¨»é‡‹ç›¸é—œä»£ç¢¼
3. å°‡ `'YOUR_ACTUAL_USER_ID_HERE'` æ›¿æ›ç‚ºæ­¥é©Ÿ1ä¸­ç²å¾—çš„å¯¦éš›ç”¨æˆ¶ID
4. åŸ·è¡Œè…³æœ¬

**ç¤ºä¾‹ä»£ç¢¼**ï¼š
```sql
-- åœ¨ä¿®å¾©ç‰ˆè…³æœ¬ä¸­å–æ¶ˆè¨»é‡‹ä¸¦æ›¿æ› UUID
INSERT INTO public.user_profiles (
    id,
    email,
    full_name,
    role,
    status,
    initial_capital,
    currency,
    timezone,
    trading_experience,
    approved_at,
    approved_by,
    created_at,
    updated_at
) VALUES (
    'ä½ çš„å¯¦éš›ç”¨æˆ¶ID'::uuid,  -- æ›¿æ›ç‚ºçœŸå¯¦çš„ç”¨æˆ¶ ID
    'admin@txn.test',
    'TXN æ¸¬è©¦ç®¡ç†å“¡',
    'admin',
    'active',
    100000.00,
    'USD',
    'Asia/Taipei',
    'professional',
    NOW(),
    'ä½ çš„å¯¦éš›ç”¨æˆ¶ID'::uuid,  -- æ›¿æ›ç‚ºçœŸå¯¦çš„ç”¨æˆ¶ ID
    NOW(),
    NOW()
)
ON CONFLICT (id) DO UPDATE SET
    role = 'admin',
    status = 'active',
    full_name = 'TXN æ¸¬è©¦ç®¡ç†å“¡',
    approved_at = NOW(),
    updated_at = NOW();
```

---

### ğŸ” æ–¹æ³•äºŒï¼šè‡ªå‹•æª¢æ¸¬è¨­ç½®

å¦‚æœæ‚¨å·²ç¶“åœ¨ Supabase Auth ä¸­å‰µå»ºäº† `admin@txn.test` ç”¨æˆ¶ï¼š

1. ç›´æ¥åŸ·è¡Œ `20250825_180000_create_test_admin_fixed.sql`
2. è…³æœ¬æœƒè‡ªå‹•æª¢æ¸¬ç¾æœ‰èªè­‰ç”¨æˆ¶
3. è‡ªå‹•è¨­ç½®ç‚ºç®¡ç†å“¡è§’è‰²
4. ç„¡éœ€æ‰‹å‹•æ›¿æ› UUID

---

### ğŸ§ª æ–¹æ³•ä¸‰ï¼šç´”æ¸¬è©¦ç’°å¢ƒ

å¦‚æœæ‚¨åªéœ€è¦æ¸¬è©¦ç®¡ç†é¢æ¿é¡¯ç¤ºï¼Œä¸éœ€è¦ç™»å…¥åŠŸèƒ½ï¼š

1. ç›´æ¥åŸ·è¡Œ `20250825_180000_create_test_admin_fixed.sql`
2. è…³æœ¬æœƒè‡ªå‹•å‰µå»ºæ¸¬è©¦ç”¨æˆ¶æ•¸æ“š
3. å‰µå»ºçš„ç”¨æˆ¶ç„¡æ³•ç™»å…¥ï¼Œä½†å¯åœ¨ç®¡ç†é¢æ¿ä¸­æŸ¥çœ‹
4. é©åˆæ¸¬è©¦ UI é¡¯ç¤ºå’ŒåŠŸèƒ½

### ğŸ’¡ æ¸¬è©¦æ•¸æ“šèªªæ˜
ä¿®å¾©ç‰ˆè…³æœ¬æœƒè‡ªå‹•å‰µå»ºä»¥ä¸‹æ¸¬è©¦æ•¸æ“šï¼š

#### æ¸¬è©¦ç”¨æˆ¶é¡å‹ï¼š
- **å¾…å¯©æ ¸ç”¨æˆ¶**: 3å€‹ç”¨æˆ¶ï¼Œä¸åŒç¶“é©—ç­‰ç´š
- **æ´»èºç”¨æˆ¶**: 1å€‹å·²æ‰¹å‡†çš„ç”¨æˆ¶
- **åœç”¨ç”¨æˆ¶**: 1å€‹å·²åœç”¨çš„ç”¨æˆ¶
- **ç®¡ç†å“¡æ—¥èªŒ**: ç¤ºä¾‹æ“ä½œè¨˜éŒ„
- **æ¸¬è©¦ç­–ç•¥**: é è¨­äº¤æ˜“ç­–ç•¥

#### æ¸¬è©¦æ•¸æ“šç‰¹é»ï¼š
- ä½¿ç”¨å‹•æ…‹ UUIDï¼Œé¿å…å¤–éµç´„æŸéŒ¯èª¤
- åŒ…å«å®Œæ•´çš„ç”¨æˆ¶ç‹€æ…‹æµç¨‹
- æä¾›è±å¯Œçš„æ¸¬è©¦å ´æ™¯

## ğŸ§ª æ¸¬è©¦åŠŸèƒ½

è¨­ç½®å®Œæˆå¾Œï¼Œæ‚¨å¯ä»¥æ¸¬è©¦ä»¥ä¸‹åŠŸèƒ½ï¼š

### 1. ç™»å…¥ç®¡ç†å“¡é¢æ¿
- å‰å¾€ `/auth` é é¢
- ä½¿ç”¨ `admin@txn.test` å’Œ `AdminTest123!` ç™»å…¥
- ç™»å…¥å¾Œæ‡‰è©²æœƒçœ‹åˆ°æˆåŠŸé€šçŸ¥

### 2. è¨ªå•ç®¡ç†å“¡æ§åˆ¶é¢æ¿
- å‰å¾€ `/admin` é é¢
- æ‡‰è©²å¯ä»¥çœ‹åˆ°ï¼š
  - âœ… ç”¨æˆ¶çµ±è¨ˆå¡ç‰‡
  - âœ… å¾…å¯©æ ¸ç”¨æˆ¶åˆ—è¡¨
  - âœ… æ‰¹å‡†/æ‹’çµ•æŒ‰éˆ•
  - âœ… é€šçŸ¥ç³»çµ±
  - âœ… ç¢ºèªå°è©±æ¡†

### 3. æ¸¬è©¦ç®¡ç†å“¡æ“ä½œ
- æ‰¹å‡†å¾…å¯©æ ¸ç”¨æˆ¶
- æ‹’çµ•ç”¨æˆ¶ç”³è«‹
- æŸ¥çœ‹æ“ä½œé€šçŸ¥
- æ¸¬è©¦ç¢ºèªå°è©±æ¡†

## ğŸ”§ æ•…éšœæ’é™¤

### å•é¡Œï¼šå¤–éµç´„æŸéŒ¯èª¤
**éŒ¯èª¤è¨Šæ¯**: `violates foreign key constraint "user_profiles_id_fkey"`
**è§£æ±ºæ–¹æ¡ˆ**:
1. âœ… ä½¿ç”¨ä¿®å¾©ç‰ˆè…³æœ¬ `20250825_180000_create_test_admin_fixed.sql`
2. é¸æ“‡é©åˆçš„æ–¹æ³•ï¼ˆä¸€ã€äºŒã€ä¸‰ï¼‰
3. ç¢ºä¿åœ¨ Supabase Auth ä¸­æœ‰å°æ‡‰çš„ç”¨æˆ¶è¨˜éŒ„

### å•é¡Œï¼šç„¡æ³•ç™»å…¥
**è§£æ±ºæ–¹æ¡ˆ**:
1. ç¢ºèªä½¿ç”¨æ–¹æ³•ä¸€æˆ–æ–¹æ³•äºŒå‰µå»ºäº†èªè­‰ç”¨æˆ¶
2. æª¢æŸ¥ Supabase Auth ä¸­ç”¨æˆ¶å·²å‰µå»ºä¸”ç¢ºèª
3. ç¢ºèªå¯†ç¢¼æ˜¯å¦æ­£ç¢ºï¼š`AdminTest123!`
4. ç¢ºèª Email confirmations å·²é—œé–‰

### å•é¡Œï¼šç™»å…¥å¾Œç„¡æ³•è¨ªå•ç®¡ç†å“¡é¢æ¿
**è§£æ±ºæ–¹æ¡ˆ**:
1. ç¢ºèªä¿®å¾©ç‰ˆ SQL è…³æœ¬å·²æ­£ç¢ºåŸ·è¡Œ
2. æª¢æŸ¥ `user_profiles` è¡¨ä¸­çš„ `role` æ˜¯å¦ç‚º `admin`
3. æª¢æŸ¥ `status` æ˜¯å¦ç‚º `active`
4. æª¢æŸ¥æ§åˆ¶å°æ˜¯å¦æœ‰éŒ¯èª¤è¨Šæ¯

### å•é¡Œï¼šçœ‹ä¸åˆ°å¾…å¯©æ ¸ç”¨æˆ¶
**è§£æ±ºæ–¹æ¡ˆ**:
1. ä¿®å¾©ç‰ˆè…³æœ¬æœƒè‡ªå‹•å‰µå»ºæ¸¬è©¦ç”¨æˆ¶
2. å¦‚æœæ²’æœ‰ï¼Œè«‹é‡æ–°åŸ·è¡Œè…³æœ¬
3. æˆ–è€…è¨»å†Šæ–°ç”¨æˆ¶é€²è¡Œæ¸¬è©¦

### å•é¡Œï¼šæ–¹æ³•ä¸‰ç„¡æ³•ç™»å…¥
**èªªæ˜**: 
- æ–¹æ³•ä¸‰åƒ…å‰µå»ºæ•¸æ“šåº«è¨˜éŒ„ï¼Œä¸å‰µå»ºèªè­‰ç”¨æˆ¶
- å¦‚éœ€ç™»å…¥ï¼Œè«‹ä½¿ç”¨æ–¹æ³•ä¸€æˆ–æ–¹æ³•äºŒ
- æ–¹æ³•ä¸‰é©åˆç´” UI æ¸¬è©¦

## ğŸ“Š é©—è­‰è¨­ç½®

åŸ·è¡Œä»¥ä¸‹æŸ¥è©¢é©—è­‰è¨­ç½®æ˜¯å¦æ­£ç¢ºï¼š

```sql
-- æª¢æŸ¥ç®¡ç†å“¡å¸³è™Ÿ
SELECT id, email, full_name, role, status, created_at 
FROM public.user_profiles 
WHERE email = 'admin@txn.test';

-- æª¢æŸ¥ç”¨æˆ¶çµ±è¨ˆ
SELECT status, COUNT(*) 
FROM public.user_profiles 
GROUP BY status;

-- æª¢æŸ¥ç®¡ç†å“¡æ—¥èªŒ
SELECT action, created_at 
FROM public.admin_logs 
ORDER BY created_at DESC 
LIMIT 5;
```

## ğŸ§¹ æ¸…ç†æ¸¬è©¦æ•¸æ“š

æ¸¬è©¦å®Œæˆå¾Œï¼Œå¦‚éœ€æ¸…ç†æ¸¬è©¦æ•¸æ“šï¼š

```sql
-- æ¸…ç†æ¸¬è©¦ç”¨æˆ¶ï¼ˆè«‹è¬¹æ…åŸ·è¡Œï¼‰
DELETE FROM public.admin_logs WHERE admin_id IN (
    SELECT id FROM public.user_profiles WHERE email LIKE '%@test.com' OR email LIKE '%@example.com'
);

DELETE FROM public.strategies WHERE user_id IN (
    SELECT id FROM public.user_profiles WHERE email LIKE '%@test.com' OR email LIKE '%@example.com'
);

DELETE FROM public.user_profiles WHERE email LIKE '%@test.com' OR email LIKE '%@example.com';
```

---

**æ³¨æ„**: é€™äº›æ˜¯æ¸¬è©¦ç”¨å¸³è™Ÿï¼Œè«‹å‹¿åœ¨ç”Ÿç”¢ç’°å¢ƒä¸­ä½¿ç”¨ç°¡å–®å¯†ç¢¼ã€‚